import { Callout } from "nextra/components";
import Image from "next/image";
import { Tabs } from 'nextra/components'
import { Cards, Card } from 'nextra/components'

# Market Making

Market makers are essential for facilitating smooth trading activity. They provide liquidity and help assets reach their fair market value over time. Their primary function is to offer consistent buy and sell options, rather than to influence price or generate trading volume. Given this objective, there is merit in replacing traditional market makers with a system that operates impartially and transparently.

In traditional market making, the challenge lies in determining how much liquidity to deploy, and across which price ranges. Baseline addresses this challenge by employing a system with three distinct price ranges, each with distinct liquidity profiles.

### Price Ranges
Baseline tokens utilize three distinct price ranges for liquidity allocation: Floor, Anchor, and Discovery. Each range serves a specific purpose and is programmatically managed according to a set of rules enforced at the smart contract level.

<Tabs items={['📈 Floor', '⚓️ Anchor', '🔎 Discovery']}>
  <Tabs.Tab>
   ![Floor](/assets/floor.png)

    The Floor is a narrow price range with highly concentrated liquidity. Its primary function is to ensure that it can absorb the entire floating supply of a Baseline Token. Think of the Floor as a substantial buy wall that allows every token holder to exit their position at the Floor price, also known as the [Baseline Value (BLV)](/concepts/blv).

    <Callout type="info" emoji="">
    Floating supply represents the amount of tokens purchased by external parties and NOT owned by the protocol. For example, a person who buys tokens from the protocol is swapping out Baseline tokens in exchange for the reserve asset. These Baseline tokens are introduced into the floating supply, and are backed by the reserve assets that now belong to the protocol. 
    </Callout>

    You may be wondering where the system sources the capital to guarantee the floor price. The liquidity is sourced from the presale of the Baseline Token (bToken). Unlike traditional token launches, where presale funds are typically distributed to the project team, Baseline token launches keep the liquidity in the market making system. See the [presale](/launching#presale) section to learn how the initial liquidity is provisioned.


  </Tabs.Tab>

  <Tabs.Tab>

  ![Anchor](/assets/anchor.png)

    The Anchor is a price range with lower liquidity depth compared to the Floor, but covers a broader price span. Unlike the Floor which is designed to hold price, the Anchor is designed to encourage price movements and support trading activity. 

    The Anchor is a dynamic price range that is updated after a [liquidity rebalance](/concepts/market_making#rebalancing-liquidity). The Anchor occupies the price range from the market price and extends towards the Floor.


  </Tabs.Tab>

  <Tabs.Tab>

    ![Discovery](/assets/discovery.png)

    The Discovery is a price range with thicker liquidity compared to the Anchor, and spans an even broader price range. Similar to Anchor, the Discovery is a dynamic price range that is updated after a [liquidity rebalance](/concepts/market_making#rebalancing-liquidity). The Discovery occupies the price range from the market price and extends considerably higher. The Anchor and Discovery were built with these liquidity profiles in order for the system to take profit during uptrends, and move these profits to the Floor in order to initiate a `bump()`. This strategy is explained in greater detail in the [`sweep()`](/concepts/market_making#rebalancing-liquidity) section.


  </Tabs.Tab>

</Tabs>
___
&nbsp;

### Swap Fees
In Uniswap V3 pools, every trade incurs a small fee, known as the swap fee. This fee is collected from traders and paid to liquidity providers.

In the Baseline system, the protocol itself acts as the main liquidity provider. As a result, it collects most of the swap fees generated from trading activity within these pools. These fees are then sent to the [Afterburner module](/concepts/afterburner) to conduct leveraged token buybacks and token burning. When there is a sufficient surplus in the system (either through increased reserves or decreased floating supply), the system will attempt to [`bump()`](/concepts/market_making#rebalancing-liquidity) up the Floor price.

{/*insert animation of swapping occurring, and 1% of the volume getting slowly redirected into the floor*/
}

### Advanced Topics

#### Rebalancing Liquidity
Markets are constantly changing, with varying levels of trading activity and price movements. ​​Rebalancing allows market makers to adapt to these changes, ensuring that liquidity remains appropriately distributed. In the context of Baseline, this involves dynamically shifting liquidity across Floor, Anchor, and Discovery price ranges.

The Baseline market making system has four methods to rebalance liquidity: `bump()`, `sweep()`, `slide()`, and `drop()`. 
<Callout emoji="">
<Tabs items={['⬆️ Bump', '➡️ Sweep', '⬅️ Slide', '⬇️ Drop']}>
  <Tabs.Tab>
    When the Floor can be moved higher the protocol calls: `bump()`

    <video controls autoplay>
  <source src="/assets/Bump.mp4" type="video/mp4" />
</video>

    **Description**  
    A `bump()` operation shifts the highly concentrated liquidity within the Floor to a slightly higher price range. A `bump()` is a permanent change and cannot be reversed.

    **Condition**  
    A `bump()` can be initiated when there is sufficient reserve capacity (e.g., ETH or USD) to purchase the entire floating supply at the new, elevated price point. This new price point is one [tick spacing](#tick-spacing0) above the current Floor.

    **Purpose**  
    The `bump()` operation provides a mechanism for the market making system to increase the BLV, securing a higher token floor price. 
  </Tabs.Tab>

  <Tabs.Tab>
    When the price is trending upwards the protocol calls: `sweep()`

    <video controls autoplay>
  <source src="/assets/Sweep_1.mp4" type="video/mp4" />
</video>

    **Description**  
    A `sweep()` operation adjusts the Anchor and Discovery price ranges to align more closely with the current market price. This ensures that liquidity is optimally distributed in response to upward price movements.

    **Condition**  
    A `sweep()` is initiated when the price of the token has increased 2% into the Discovery price range.

    **Purpose**  
    The `sweep()` operation provides a mechanism for the market making system to secure profits and build up surplus capacity. This is accomplished by selling tokens at a higher price and rebuying them for cheaper. 

    <Callout type="info" emoji="" >
    Every `sweep()` operation serves as a checkpoint, updating the `discovery tick` to the current price.
    </Callout>
  </Tabs.Tab>

  <Tabs.Tab>
    When the price is trending downwards the protocol calls: `slide()`

     {/*insert slide animation*/}

    **Description**  
    A `slide()` operation repositions the Anchor price range around the market price when the price is trending downwards.

    **Condition**  
    A `slide()` is initiated when the price of the token has decreased 2% from its last recorded checkpoint. 


    **Purpose**  
    The goal of the `slide()` operation is to absorb sell pressure during downtrends. This is achieved by repositioning the Anchor price range closer to the Floor, allowing the market making system to absorb sell pressure at a discounted price. In addition, the liquidity in the Anchor is thinned out, allowing the price to recover more easily. 

<Callout type="info" emoji="">
    Every `slide()` operation serves as a checkpoint, updating the `slide tick` to the current price.
    </Callout>
  </Tabs.Tab>

  <Tabs.Tab>
    When the Discovery price range can be moved lower the protocol calls: `drop()`

     {/*insert drop animation*/}

    **Description**  
    A `drop()` operation repositions the Discovery price range closer to the market price. 

    **Condition**  
    A `drop()` can be initiated once every 24 hours to reduce the distance between the last recorded `discovery tick` and the current market price by 20%.

    **Purpose**  
    The `drop()` operation repositions the Discovery range to a slightly lower price range following `slide()` operations. In addition, liquidity in the Discovery is thinned, allowing the price to recover more easily.

    <Callout type="info" emoji="">
    Every `drop()` operation serves as an update checkpoint for the `discovery tick`, placing it 20% below the previous checkpoint. 
    </Callout>
  
  </Tabs.Tab>
</Tabs>
</Callout>
---

#### Automated Rebalancing 
These strategies are written at the smart contract level and exist as public functions. This means any external party can execute these functions so long as the condition is satisfied for each operation. Baseline monitors the state of the liquidity pool and will call these functions automatically.

#### Uniswap V3 Concepts

**Ticks**  
In Uniswap V3 pools, prices are determined using a system called ticks. Each tick represents a very small price increment (1 basis point or 0.01%). As an example, 100 ticks correspond to approximately a 1% change in price.

**Tick Spacing**  
Uniswap V3 pools use [tick spacing](https://support.uniswap.org/hc/en-us/articles/21069524840589-What-is-a-tick-when-providing-liquidity) to define where liquidity can be allocated. The tick spacing spacing is determined by the pool's swap fee percentage. For example, a pool with a 1% swap fee has a tick spacing of 200. This means liquidity can only be allocated in increments of 200 ticks, which covers approximately a 2% price range.

In Baseline pools, the Floor price range is defined within one tick spacing. The BLV represents the lower bound of this tick spacing. When a `bump()` operation occurs in a 1% fee pool, the system will attempt to move the Floor price range one tick spacing higher (~2% higher).
