import { Callout } from "nextra/components";
import Image from "next/image";
import { Tabs } from 'nextra/components'
import { Cards, Card } from 'nextra/components'



## Market Making

### Introduction
Market makers are essential for facilitating smooth trading activity. They provide liquidity and help assets reach their fair market value over time. Their primary function is to offer consistent buy and sell options, rather than to influence price or generate trading volume. Given this objective, there is merit in replacing traditional market makers with a system that operates impartially and transparently.

In traditional market making, the challenge lies in determining how much liquidity to deploy, and across which price ranges. Baseline addresses this challenge by employing a system with three distinct price ranges, each with distinct liquidity profiles.

### Price Ranges
Baseline tokens utilize three distinct price ranges for liquidity allocation: Floor, Anchor, and Discovery. Each range serves a specific purpose and is programmatically managed according to a set of rules enforced at the smart contract level.
 <Cards>
    <Card title="üìà „Éª Floor" href="/concepts/market_making/floor" style={{backgroundColor: 'black', padding: '0.1rem'}} />
</Cards>
 <Cards>
    <Card title="‚öìÔ∏è „Éª Anchor" href="/concepts/market_making/anchor" style={{backgroundColor: 'black', padding: '0.1rem'}} /> 
</Cards>
 <Cards>
    <Card title="üîé „Éª Discovery" href="/concepts/market_making/discovery" style={{backgroundColor: 'black', padding: '0.1rem'}} />
</Cards>

### Swap Fees
In Uniswap V3 pools, every trade incurs a small fee, known as the swap fee. This fee is collected from traders and paid to liquidity providers.

In the Baseline system, the protocol itself acts as the main liquidity provider. As a result, it collects most of the swap fees generated from trading activity within these pools. These fees are then sent to the [Afterburner module](/concepts/afterburner) to conduct leveraged token buybacks and token burning. When there is a sufficient surplus in the system (either through increased reserves or decreased floating supply), the system will attempt to [`bump()`](/concepts/market_making#rebalancing-liquidity) up the Floor price.

{/*insert animation of swapping occurring, and 1% of the volume getting slowly redirected into the floor*/
}

### Advanced Topics

#### Rebalancing Liquidity
Markets are constantly changing, with varying levels of trading activity and price movements. ‚Äã‚ÄãRebalancing allows market makers to adapt to these changes, ensuring that liquidity remains appropriately distributed. In the context of Baseline, this involves dynamically shifting liquidity across Floor, Anchor, and Discovery price ranges.

The Baseline market making system has four methods to rebalance liquidity: `bump()`, `sweep()`, `slide()`, and `drop()`. 
<Callout emoji="">
<Tabs items={['‚¨ÜÔ∏è Bump', '‚û°Ô∏è Sweep', '‚¨ÖÔ∏è Slide', '‚¨áÔ∏è Drop']}>
  <Tabs.Tab>
    When the Floor can be moved higher the protocol calls: `bump()`

    **Description**  
    - A `bump()` operation shifts the highly concentrated liquidity within the Floor to a slightly higher price range. A `bump()` is a permanent change and cannot be reversed.

    **Condition**  
    - A `bump()` can be initiated when there is sufficient reserve capacity (e.g., ETH or USD) to purchase the entire floating supply at the new, elevated price point. This new price point is one [tick spacing](#tick-spacing0) above the current Floor.

    {/*insert bump animation*/}

    **Purpose**  
    - Make number go up.
  </Tabs.Tab>

  <Tabs.Tab>
    When the price is trending upwards the protocol calls: `sweep()`

    **Description**  
    A `sweep()` operation adjusts the Anchor and Discovery price ranges to align more closely with the current market price. This ensures that liquidity is optimally distributed in response to upward price movements.

    **Condition**  
    A `sweep()` is initiated when the price of the token has increased 2% into the Discovery price range.

    {/*insert [sweep animation] ‚Üê- this is pretty crucial animation to explain how the system takes profit*/}

    **Purpose**  
    The `sweep()` operation provides a mechanism for the market making system to secure profits and build up surplus capacity. This is accomplished by selling tokens at a higher price and rebuying them for cheaper. 

    <Callout type="info" emoji="" >
    Every `sweep()` and `slide()` operation updates the current price as the latest checkpoint.
    </Callout>
  </Tabs.Tab>

  <Tabs.Tab>
    When the price is trending downwards the protocol calls: `slide()`

    **Description**  
    A `slide()` operation repositions the Anchor and Discovery price range closer to the market price when the price is trending downwards.

    {/*insert slide animation*/}

    **Purpose**  
    The primary goal of a `slide()` operation is to absorb sell pressure during downtrends. This is achieved by repositioning the Anchor price range closer to the Floor, allowing the market making system to absorb sell pressure at a discounted price. In addition, the liquidity in Anchor and Discovery is thinned out, allowing the price to recover more easily. 

    **Condition**  
    A `slide()` is initiated when the price of the token has decreased 2% from its last recorded checkpoint. 

    <Callout type="info" emoji="">
    Every `sweep()` and `slide()` operation updates the current price as the latest checkpoint.
    </Callout>
  </Tabs.Tab>

  <Tabs.Tab>
    When the x can be moved lower the protocol calls: `drop()`

    **Description**  
    - A `drop()` operation shifts the highly concentrated liquidity within the x to a slightly lower price range. 

    **Condition**  
    - A `drop()` can be initiated when there is

    {/*insert drop animation*/}

    **Purpose**  
    - Make number go down.
  </Tabs.Tab>
</Tabs>
</Callout>
---

#### Automated Rebalancing 
These strategies are written at the smart contract level and exist as public functions. This means any external party can execute these functions so long as the condition is satisfied for each operation. Baseline monitors the state of the liquidity pool and will call these functions automatically.

#### Uniswap V3 Concepts

**Ticks**  
In Uniswap V3 pools, prices are determined using a system called ticks. Each tick represents a very small price increment (1 basis point or 0.01%). As an example, 100 ticks correspond to approximately a 1% change in price.

**Tick Spacing**  
Uniswap V3 pools use [tick spacing](https://support.uniswap.org/hc/en-us/articles/21069524840589-What-is-a-tick-when-providing-liquidity) to define where liquidity can be allocated. The tick spacing spacing is determined by the pool's swap fee percentage. For example, a pool with a 1% swap fee has a tick spacing of 200. This means liquidity can only be allocated in increments of 200 ticks, which covers approximately a 2% price range.

In Baseline pools, the Floor price range is defined within one tick spacing. The BLV represents the lower bound of this tick spacing. When a `bump()` operation occurs in a 1% fee pool, the system will attempt to move the Floor price range one tick spacing higher (~2% higher).
